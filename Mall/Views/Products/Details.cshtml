@model Products
@{
    ViewBag.Title = "商品详情";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string auth = MyAuthentication.GetAuth();
}

<div class="item d-flex flex-wrap container align-items-center justify-content-between">
    <h2 class="fw-bold">@ViewBag.Title</h2>
</div>
<div class="item d-flex flex-wrap container" style="display: flex;flex-direction: row;">
    <div class="card mb-3 rounded-3" style="height: 100%;">
        <div class="row g-0">
            <div class="col-md-4">
                <div class="flow" style="height: 100%;">
                    <div class="slider-for">
                        @foreach (var item in Model.Photos)
                        {
                            <img src="@item.PhotoUrl" alt="">
                        }
                    </div>
                    <div class="slider-nav" style="overflow: hidden;">
                        @foreach (var item in Model.Photos)
                        {
                            <img src="@item.PhotoUrl" alt="">
                        }
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card-body info">
                    <h1 class="title">@Model.Title</h1>
                    <h5 class="market-price">市场价: &yen;@Model.MarketPrice</h5>
                    <h5 class="price">活动价: &yen;@Model.Price</h5>
                    <h5 class="stock">库存: @Model.Stock 件</h5>
                    <div class="btn-group count" role="group" aria-label="Basic example" style="width: 40%;">
                        <span class="btn btn-secondary">销量 @Model.OrdersDetails.Sum(p => p.Quantity)</span>
                        <span class="btn btn-secondary">累计评价 @Model.Appraises.Count()</span>
                    </div>
                    <div class="input-group mb-3" role="group" aria-label="Basic example" style="width: 100%;">
                        <span class="input-group-text">购买数量:</span>
                        <input class="input-group-text" type="number" style="width: 90px;" class="form-control"
                               value="1">
                        <span class="input-group-text">件</span>
                    </div>
                    <button type="button" class="btn btn-success">立即购买</button>
                    <button type="button" class="btn btn-primary">加入购物车</button>
                </div>
            </div>
        </div>
    </div>
    <div class="card" style="width: 100%; height: 100%; justify-content: flex-start;">
        <nav>
            <div class="nav nav-tabs mb-3" id="nav-tab" role="tablist">
                <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home"
                        type="button" role="tab" aria-controls="nav-home" aria-selected="true">详细信息
                </button>
                <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile"
                        type="button" role="tab" aria-controls="nav-profile" aria-selected="false">评论(@Model.Appraises.Count())
                </button>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade details active show" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                @Html.Raw(Model.Content)
            </div>
            <div class="tab-pane fade active" id="nav-profile" role="tabpanel"
                 aria-labelledby="nav-profile-tab">
                <form action="/Products/Details/@Model.ProductID" method="get" role="search">
                    <div class="input-group mb-3">
                        <select class="form-select" aria-label="Default select example" name="appraiseLevel">
                            <option value="-1" @if (TempData["appraiseLevel"].ToString() == "All") { @Html.Raw("selected") }>全部</option>
                            <option value="0" @if (TempData["appraiseLevel"].ToString() == "Good") { @Html.Raw("selected") }>好评</option>
                            <option value="1" @if (TempData["appraiseLevel"].ToString() == "Mediuem") { @Html.Raw("selected") }>中评</option>
                            <option value="2" @if (TempData["appraiseLevel"].ToString() == "Bad") { @Html.Raw("selected") }>差评</option>
                        </select>
                        <select class="form-select" aria-label="Default select example" name="appraiseOrderBy">
                            <option value="1" @if (TempData["appraiseOrderBy"].ToString() == "1") { @Html.Raw("selected") }>按时间</option>
                            <option value="0" @if (TempData["appraiseOrderBy"].ToString() == "0") { @Html.Raw("selected") }>默认</option>
                        </select>
                        <select class="form-select" aria-label="Default select example" name="appraiseSortBy">
                            <option value="1" @if (TempData["appraiseSortBy"].ToString() == "1") { @Html.Raw("selected") }>降序</option>
                            <option value="0" @if (TempData["appraiseSortBy"].ToString() == "0") { @Html.Raw("selected") }>升序</option>
                        </select>
                        <a class="btn btn-secondary" href="/Products/Details/@Model.ProductID">清空</a>
                        <button class="btn btn-secondary" type="submit">确定</button>
                    </div>
                </form>
                @foreach (var item in ViewBag.Appraise)
                {
                    <div class="card" style="width: 100%;justify-content: flex-start;height: 100%;">
                        <div class="card-header">【@(item.Grade == 0 ? "好评" : item.Grade == 1 ? "中评" : "差评")】 @item.Users.UserName @if(auth == "0" || auth == "1") { <a href="/Products/AppraiseDelete/@Model.ProductID?aid=@item.AppraiseID" onclick="confirm('是否删除此批评论')">删除</a>}</div>
                        <div class="card-body">
                            <blockquote class="blockquote mb-0">
                                <p>@item.Content</p>
                                <footer class="blockquote-footer">
                                    @item.RateTime
                                </footer>
                            </blockquote>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
<script>
    $('.slider-for').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        arrows: false,
        fade: true,
        asNavFor: '.slider-nav',
        autoplay: true,
        autoplaySpeed: 1000
    });
    $('.slider-nav').slick({
        slidesToShow: 3,
        slidesToScroll: 1,
        asNavFor: '.slider-for',
        centerMode: true,
        focusOnSelect: true
    });
</script>
